#!/usr/bin/env node

var path    = require('path');
var fs      = require('fs');
var program = require('commander');

var lib = path.join(path.dirname(fs.realpathSync(__filename)), '..', 'lib', 'tapchat');

var Config = require(path.join(lib, 'config'));
var Engine = require(path.join(lib, 'engine'));

var version = JSON.parse(fs.readFileSync(__dirname + "/../package.json")).version;

program
  .version(version)
  .option('-f, --foreground', 'Run in foreground')
  .parse(process.argv);

Config.load(function (config) {
  new Engine(config, function (engine) {
    if (!program.foreground) {
      engine.daemonize();
    }
  });
});
